
<!DOCTYPE html>
<html lang="en">
<head>
<style>
.center {
    margin: auto;
    width: 100%;
    padding: 10px;
    font-family: "Verdana";
}
.btn-default {
    border-radius: 0px !important;
}

</style>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width = device-width, initial-scale=1">
<title>Avalon</title>

<!-- <script src="handlebars-v4.0.10.js"></script> -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet"
    href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
    crossorigin="anonymous">
<!-- Optional theme -->
<link rel="stylesheet"
    href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
    integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
    crossorigin="anonymous">

<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script>
    var socket = io();

    var btnPressNewGame = function(){
        socket.emit('btnPressNewGame',$("#nameInput").val())
    };
    var btnPressJoinGame = function(){
        socket.emit('btnPressJoinGame',{
            name: $("#nameInput").val(),
            room: $("#roomInput").val()
        });
    }

    var btnPressStartGame = function(){
        var characterSelections = [];
        $.each($("input[name='charSelection']:checked"), function(){
            characterSelections.push($(this).val());
        });
        console.log(characterSelections);
        //TODO: do validation client side
        //TODO: send to the server
    };

    socket.on('loadLobby',function(data){
        console.log("Received: [loadLobby] from server");

        lobby = data.list;
        console.log(lobby);

        var topTextReplacementStr = '<h2 id="topText" style="text-align:center;"></h2><hr>';
        document.getElementById("topDiv").innerHTML = topTextReplacementStr;
        document.getElementById("topText").innerHTML = "Avalon Room #" + data.num;
        //TODO: load the lobby here
        var hostLobbyButtonsStr = '<div class="text-center"><div class="btn-group btn-group-lg" role="group" style="box-shadow:0px 0px 0px 0px"><button type="button" class="btn btn-default" onclick="btnPressStartGame()">Start Game</button><button type="button" class="btn btn-default" onclick="btnPressLeaveGame()">Leave Game</button><button type="button" class="btn btn-default" data-toggle="collapse" data-target="#rulesContent">Rules</button></div><hr></div>';
        var characterSelectStr = '<div class="text-center"><div class="btn-group-vertical" data-toggle="buttons"><label class="btn btn-default active"><input type="checkbox" autocomplete="off" name="charSelection" value="merlin" checked>Merlin</input></label><label class="btn btn-default" aria-pressed="false"><input type="checkbox" autocomplete="off" name="charSelection" value="percival">Percival</input></label><label class="btn btn-default active" aria-pressed="true"><input type="checkbox" autocomplete="off" name="charSelection" value="goodOne" checked>1st Servant of Arthur</input></label><label class="btn btn-default active" aria-pressed="true"><input type="checkbox" autocomplete="off" name="charSelection" value="goodTwo" checked>2nd Servant of Arthur</input></label><label class="btn btn-default" aria-pressed="false"><input type="checkbox" autocomplete="off" name="charSelection" value="goodThree">3rd Servant of Arthur</input></label>' +
        '<button type="button" class="btn btn-default">-</button><button type="button" class="btn btn-default">-</button><button type="button" class="btn btn-default">-</button><button type="button" class="btn btn-default">-</button></div>' +
        '<div class="btn-group-vertical" data-toggle="buttons"><label class="btn btn-default active" aria-pressed="true"><input type="checkbox" autocomplete="off" name="charSelection" value="assassin" checked disabled="disabled">Assassin</input></label><label class="btn btn-default" aria-pressed="false"><input type="checkbox" autocomplete="off" name="charSelection" value="morgana">Morgana</input></label><label class="btn btn-default" aria-pressed="false"><input type="checkbox" autocomplete="off" name="charSelection" value="mordred">Mordred</input></label><label class="btn btn-default" aria-pressed="false"><input type="checkbox" autocomplete="off" name="charSelection" value="oberon">Oberon</input></label>' +
        '<label class="btn btn-default active" aria-pressed="true"><input type="checkbox" autocomplete="off" name="charSelection" value="evilOne" checked>1st Minion of Mordred</input></label><label class="btn btn-default" aria-pressed="false"><input type="checkbox" autocomplete="off" name="charSelection" value="evilTwo">2nd Minion of Mordred</input></label><label class="btn btn-default" aria-pressed="false"><input type="checkbox" autocomplete="off" name="charSelection" value="evilThree">3rd Minion of Modred</input></label><label class="btn btn-default" aria-pressed="false"><input type="checkbox" autocomplete="off" name="charSelection" value="evilFour">4th Minion of Modred</input></label><label class="btn btn-default" aria-pressed="false"><input type="checkbox" autocomplete="off" name="charSelection" value="evilFive">5th Minion of Modred</input></label></div><hr></div>';
        var lobbyListStr = '';
        var centerReplacementStr = hostLobbyButtonsStr + characterSelectStr + lobbyListStr;
        document.getElementById("centerDiv").innerHTML = centerReplacementStr;
        //TODO: build replacementStr

        /*
        if host, aka lobby[0].sid == socket.id...otherwise load different options

        hostLobbyButtonsStr
            [start game][leave room][rules]

        lobbyListStr
            [playerone]
            [playertwo]
            [playerthree]
            [etc...]

        characterSelectStr
        [merlin] [Assassin]
        [percival] [Morgana]
        [etc...]

        */
    })

    //characterSelect logic:


</script>

</head>

<body>
<div class="center">
<div class="container">

<!-- ########## ########## ########## ########## ########## -->

<div id="topDiv">
    <h2 id="topText" style="text-align:center;">Welcome to Avalon!</h2>
    <hr>
</div>

<!-- ########## ########## ########## ########## ########## -->

<div class="text-center">
    <p>X Players</p>
    player1
    player2
    player3
    player4
    player5
    <hr>
</div>

<!-- ########## ########## ########## ########## ########## -->

<div id="centerDiv">

<div id="inputArea" class="text-center">
    <input type="text" id="nameInput" maxlength="20" style="text-align:center; height: auto; width: 40%; transparent; outline-width: 0px; outline-style: solid;" spellcheck="false" placeholder="Your Name">
    <p></p>
    <input type="text" id="roomInput" maxlength="20" style="text-align:center; height: auto; width: 40%; transparent; outline-width: 0px; outline-style: solid;" spellcheck="false" placeholder="Room Number" data-toggle="collapse" data-target="#roomNumNotifyContent">
    <h6 id="roomNumNotifyContent" class="collapse">No Room # needed if not trying to join.</h6>
    <hr>
</div>
<div class="text-center">
    <div class="btn-group btn-group-lg" role="group" style="box-shadow:0px 0px 0px 0px">
        <button type="button" class="btn btn-default" onclick="btnPressNewGame()">New Game</button>
        <button type="button" class="btn btn-default" onclick="btnPressJoinGame()">Join Game</button>
        <button type="button" class="btn btn-default" data-toggle="collapse" data-target="#rulesContent">Rules</button>
    </div>
    <hr>
</div>

</div>  <!-- centerDiv -->

<!-- ########## ########## ########## ########## ########## -->

<!-- class="collapse in" for expanded by default -->
<div id="rulesContent" class="collapse">
    <div class="well" style="background:none;">
        <h4>Overview</h4>
            All players are randomly assigned a character. This character is either on the side of Good or the side of Evil, and may have a special ability that affects the game in some way.  Agents of Evil are told who the other Evil players are.  All players are candidates to go on quests.  The side of Good wishes to complete three quests successfully, and Evil wishes three quests to fail.  Merlin has knowledge of the agents of Evil, and must try to guide Good to approve only Good players on the questing party.  But he must hide his identity; the Assassin has a chance to kill Merlin at the end of the game.  If she successfully kills Merlin, Evil wins instead.
        <h4>Selection Phase</h4>
            At the start of each round, the current party leader proposes a set of players who will go on the quest.  The size of the party is predetermined, decided by the number of players and the quest.  All players are free to talk during this phase to convince others of their suspicions or state who they would like to be on the party.  For Good, it is critical no Evil players make it onto the quest.
        <h4>Voting Phase</h4>
             Once an official decision is made, further discussion can take place before it is voted on.  If a majority of players reject the party, a different player is assigned the role of party leader and players are reselected.  If five parties are rejected within a single voting phase, Good foreits the game.  If the majority approves the party, the game continues the questing phase.
        <h4>Questing Phase</h4>
            Once a majority agrees on a party, that party will go on the quest.  Agents of Good can only help it succeed, but agents of Evil can choose to contribute to its success or fail the quest.  Only one fail action is neccessary for the quest to fail.  Once every player has selected an action, the actions are revealed but not associated with the acting player.  After, the party is disbanded and the game returns to the selection phase of a new quest.
        <h4>Game End</h4>
            Questing ends when three quests have succeeded or three quests have failed.  If the latter occurs, Evil wins and the game is over.  If the former occurs, Good may have won.  After the third successful quest, the Assassin will select an agent of Good.  If that player is Merlin, Evil wins despite the results of the quests.
    </div>
    <hr>
</div> <!-- rulesContent -->

<!-- ########## ########## ########## ########## ########## -->



<!-- ########## ########## ########## ########## ########## -->

<div style="text-align:center;">
    <h6>Tyler Nishida | Based on "The Resistance: Avalon" board game by Don Eskridge | Not endorsed by or affiliated with Indie Boards & Cards | https://github.com/tnishida95/avalon-game</h6>
</div>

<!-- ########## ########## ########## ########## ########## -->

</div> <!-- container -->
</div> <!-- center -->

</body>
</html>
